---
title: "Voter Characteristics and Political Support in the US"
# subtitle: "My subtitle if needed"
author: 
  - Tam Ly
  - Renfrew Ao-Ieong
  - Rahma Binth Mohammad
thanks: "Code and data are available at: https://github.com/atn-ly/political_support_in_the_us"
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#### Workspace setup ####

library(tidyverse)
library(rstanarm)
library(knitr)
library(here)
library(ggplot2)
library(arrow)
library(scales)
library(modelsummary)
library(marginaleffects )

# Read in cleaned data
ces2020 = read_parquet(
  file = here("data/analysis_data/ces2020_analysis_data.parquet"),
  show_col_types = FALSE
)

# Read in model
political_preferences <-
  readRDS(file = here::here("models/political_preferences.rds"))

```

# Introduction

The United States (US) presidential election of 2020 resulted in President Joe Biden’s victory, making him the 46th President of the US. The two top runners were Biden for the Democrats and former President Donald Trump for the Republicans. The presidential race between the two was of significant interest to statisticians and polling experts due to its potential impact on polling models and election forecasting. To provide some background, President Biden ran on his merit as a former Vice President of eight years and had faced lots of criticism during his time in office. Moreover, Former President Trump had controversial and career-damaging events. During the 2016 lections, Trump even faced Before the 2020 elections, Trump was charged with misconduct while in office(cite). However, the senate acquitted him of those charges. Thus, both Biden and Trump faced criticism from the electorate. An interesting question to consider is despite these, what characteristics did the voters have? Do they tell us a story on the type of people that voted for Biden and the type that voted for Trump? Answering these questions can help develop polling models and future election forecasting.

For our paper, we used a logistic regression model to estimate the likelihood of voting for Biden or Trump given certain characteristics. We use a binary outcome variable and three predictor variables. Our estimand is the probability that an individual voted for Biden or Trump based on three characteristics, their gender, race, and ownership of a gun. The reason for this choice will be further examined in @sec-model. This data driven approach to elections can bring insight to voter characteristics and the importance of survey data and knowing the electorate.

[insert more of what was done and what was found - overview of results section]

The survey data for this paper is from the Harvard Dataverse Repository. The Cooperative Election Study is a sample survey that consists of pre-election and post-election questions. They provide a guide and a dataset for numerous years. It is also open to the public. [add more]

Data for this analysis and the different applications used will be further introduced in @sec-data. @sec-model provides the model set-up and the justification for the use of that model. @sec-results will show results and @sec-discussion is a discussion of the results including the paper’s weaknesses and biases. 


# Data {#sec-data}

```{r}
#| echo: false
#| message: false
#| label: tmp-label1
#| tbl-cap: tmp-caption1

ces2020 |>
  ggplot(aes(x = race, fill = voted_for)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(gender)) +
  theme_minimal() +
  labs(
    x = "Race",
    y = "Number of respondents",
    fill = "Voted for"
  ) +
  coord_flip() +
  scale_x_discrete(limits = rev) +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")

```

```{r}
#| echo: false
#| message: false
#| label: tmp-label2
#| tbl-cap: tmp-caption2

ces2020 |>
  ggplot(aes(x = gun_ownership, fill = voted_for)) +
  stat_count(position = "dodge") +
  facet_wrap(facets = vars(gender)) +
  theme_minimal() +
  labs(
    x = "Gun Ownership",
    y = "Number of respondents",
    fill = "Voted for"
  ) +
  coord_flip() +
  scale_x_discrete(limits = rev, labels = label_wrap(10)) +
  scale_fill_brewer(palette = "Set1") +
  theme(legend.position = "bottom")

```

## Sources and Collection

For this paper, we utilized the data from the 2020 Presidential Elections. We selected, gender, race, and whether an individual or a family member in the household owns a gun. We also selected the variable that recorded whether an individual voted for Biden or Trump. The broader context of the dataset is the political landscape of the US during the election cycle of 2020. The outcome of the 2020 election and every presidential election usually changes the direction of the country and demonstrates the perspectives of the majority of the electorate. There may have been similar dataset available, but we chose this one due to relevance to our research question. The questionnaire asked various questions on race, political party preference, voting preference, ownership of a gun and have numerous multiple choice answers available. Thus, this survey data provided us with the information on the demographic characteristics we wanted to consider. 

Our paper aims to address the following two questions: (1) Does gender and race play a role in political preference? (2) Do those that own a gun favour one candidate over the other?

## Methodology

## Variables

## Measurement


# Model {#sec-model}

## Model set-up

The goal of our modeling strategy is to forecast if a person is likely to vote for Biden, based only on knowing their gender, race, and gun ownership status.

The model that we are interested in is:

\begin{align} 
y_i|\pi_i &\sim \mbox{Bern}(\pi_i) \\
\mbox{logit}(\pi_i) &= \alpha + \beta \times \mbox{gender}_i + \gamma \times \mbox{education}_i + \delta \times \mbox{gun}_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\delta &\sim \mbox{Normal}(0, 2.5)
\end{align}

Where:

* $y_i$ is the binary outcome variable, representing who respondent $i$ voted for and equal to 1 if Biden and 0 if Trump, 
* $\pi_i$ is the probability that respondent $i$ voted for Biden, 
* ${gender}_i$ is a predictor variable, representing the gender of respondent $i$, 
* ${race}_i$ is a predictor variable, representing the race of respondent $i$, and 
* ${gun}_i$ is a predictor variable, representing the gun ownership status of respondent $i$.

We used a logistic regression model in a Bayesian framework using the package `rstanarm` [@rstanarm] in R [@citeR], which we will briefly describe here. Logistic regression is a type of generalized linear model. It is a tool for data exploration and used when we are interested in the relationship between a binary outcome variable and some predictor variables. 

The foundation of logistic regression is the Bernoulli distribution and logit function. The Bernoulli distribution is a discrete probability distribution having two possible outcomes, “1” and “0”, in which “1” occurs with probability $p$ and “0” occurs with probability $1-p$. Logistic regression is still a linear model, because the predictor variables enter in a linear fashion [@rohan]. Hence, the logit function links the Bernoulli distribution to the machinery we use in linear models [@rohan].

In our model, we also have the parameters $\alpha$, $\beta$, $\gamma$, and $\delta$ in addition to the variables. The parameter $\alpha$ is the intercept and the parameters, $\beta$, $\gamma$, and $\delta$, are the slope coefficients. We specify prior probability distributions for each of the parameters in our model. However, these are just the default priors that `rstanarm` [@rstanarm] uses, which are Normal distributions with a mean and standard deviation of 0 and 2.5, respectively.

## Model justification

Given that Biden and Trump are far apart on women’s issues, racial justice, and gun policy, we  chose *gender*, *race*, and *gunown* to be the predictor variables in our model. First, since we are interested in forecasting who a respondent is likely to vote for, we used *gender* instead of *gender_post* because it is representative of all adult Americans rather than only adult Americans who are registered to vote. Second, we used *race* instead of variables by country or region to affirm that race is a social construct with no biological foundation. Third, we used *gunown* instead of variables about gun control because it captures broader opinions rather than specific policy proposals. After exploring the data in the previous section, we found differences in political preference based on these features and that it would be of interest to investigate further.

Logistic regression does not make the same assumptions as linear regression. First, linear regression assumes a continuous outcome variable that can take any number on the real line, whereas logistic regression assumes a binary outcome variable. Furthermore, linear regression requires that the outcome variable is a linear function of the predictor variables, while the outcome in logistic regression is part of the exponential family. However, logistic regression does assume that the relationship between the log-odds of the binary outcome and predictor variables is linear. Lastly, unlike in linear regression, logistic regression does not require the assumption of homoscedasticity of errors.

Alternative regression models were considered, but rejected because they were not appropriate for our outcome variable. Linear models assume a continuous outcome variable, and Poisson and Negative binomial models assume count outcome variables. Since our outcome variable is binary, we chose to use logistic regression.

To show that our model does a good job of fitting the data, we consider the posterior distribution and implement posterior predictive checks. Details and graphs can be found in @sec-model-details. Furthermore, we check if the Markov Chain Monte Carlo (MCMC) sampling algorithm that `rstanarm` uses to obtain samples from the posterior distributions of interest ran into any issues. Details and graphs can be found in @sec-model-details.


# Results {#sec-results}

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-model-summary-table
#| tbl-cap: "Explanatory models of political preferences based on gender, race, and gun ownership (n = 5000)"
library(modelsummary)

modelsummary(
  list(
    "Support Biden" = political_preferences
  ),
  statistic = "mad"
  )
```

We performed logistic regression analysis on 5000 observations; a subset of the total 43240 observations from our cleaned dataset. Since we are interested in which presidential candidate an individual voted for based on the categories explained earlier, our model made `genderMale`, `raceWhite`, `gun_ownershipPersonal` into reference groups for their respective categories.

Our results from the model given by @tbl-model-summary-table shows the coefficient of each indicator variable. This coefficient represents the log of the expected difference in support for Biden compared to Trump. When this value is negative, it shows a decrease in support for Biden, when this value is 0 it shows neither a decrease nor increase in support for Biden. When this value is positive, it shows an increase in support for Biden.

The intercept is -0.748 which means that the support for Biden decreases by about 0.784 units when all other variables are held constant. By holding all variables constant, we have an individual who is Male, White, and personally owns a gun.

## Gender

We can see that for the variable `genderFemale`, we have a coefficient of 0.235 indicating an increase in support for Biden over the reference group being `genderMale`, while keeping the other variables constant.

## Race

We can see that Black individuals show a much stronger support for Biden as the coefficient for `raceBlack` is 2.464. Asian, Hispanic, and Middle Eastern individuals all show an increase in support for Biden with coefficients of 0.790, 0.548, and 0.288 respectively. Native Americans show a decrease in support for Biden with a coefficient of -0.536 while individuals of two or more races show neither an increase nor decrease in support for Biden with a coefficient of -0.008.

## Gun Ownership

For gun ownership, we can see that if an individual does not personally own a gun but someone in their household does, the coefficient is 0.870 which shows an increase in support for Biden. If nobody in an individual’s household owns a gun, the coefficient is 1.332 showing a strong support for Biden. When an individual does not own a gun and is not sure if anyone in their household owns a gun, the coefficient is -0.815 showing a decrease in support for Biden.


```{r}
#| echo: false
#| message: false
#| warning: false
#| label: tbl-biden-or-trump-predictions
#| tbl-cap: "Probability that an individual supports Biden given their demographic"
political_predictions <-
  predictions(political_preferences)

knitr::kable(head(political_predictions))
```

From the model, we used `predictions()` from `marginaleffects` [@marginaleffects] to obtain the implied probability that an individual supports Biden. A sample of the result is given in @tbl-biden-or-trump-predictions where each individual is given an `estimate` value which is the estimated probability that the individual supports Biden.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-model-gender
#| fig-cap: "Predicted support of Biden given gender vs. actual support"
political_predictions |>
  mutate(gender = factor(gender)) |>
  ggplot(aes(x = gender, y = estimate, color = voted_for)) +
  geom_jitter(width = 0.01, height = 0.01, alpha = 0.3) +
  labs(
    x = "Gender",
    y = "Estimated probability that an \n individual voted for Biden",
    color = "Candidate actually voted for"
  ) +
  theme_classic() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```

Using the results in @tbl-biden-or-trump-predictions, we plotted three graphs using `ggplot2` [@ggplot2] which shows the estimated probability that an individual supports Biden given gender, race, and gun ownership with the colour of the point indicating their true support. @fig-model-gender shows the estimated probability that an individual supports Biden given gender. To support the accuracy of our model, blue dots should be higher up on the graph while red dots should be lower down indicating that our predicted probability matches with the actual result. We can see in @fig-model-gender that this trend holds true.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-model-race
#| fig-cap: "Predicted support of Biden given race vs. actual support"
political_predictions |>
  mutate(race = factor(race)) |>
  ggplot(aes(x = race, y = estimate, color = voted_for)) +
  geom_jitter(width = 0.01, height = 0.01, alpha = 0.3) +
  labs(
    x = "Race",
    y = "Estimated probability that an \n individual voted for Biden",
    color = "Candidate actually voted for"
  ) +
  theme_classic() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  scale_x_discrete(guide = guide_axis(n.dodge=2))
```

@fig-model-race shows the estimated probability that an individual supports Biden given race. There appears to be red dots near the top for White, Native American, Middle Eastern, and Two or more races which indicates possible inaccuracy in our model. However, Black, Hispanic and Asian appears to follow the expected distribution of the dots.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-model-gun-owner
#| fig-cap: "Predicted support of Biden given gun ownership vs. actual support"
political_predictions |>
  mutate(gun_ownership = factor(gun_ownership)) |>
  ggplot(aes(x = gun_ownership, y = estimate, color = voted_for)) +
  geom_jitter(width = 0.01, height = 0.01, alpha = 0.3) +
  labs(
    x = "Gun Ownership",
    y = "Estimated probability that an \n individual voted for Biden",
    color = "Candidate actually voted for"
  ) +
  theme_classic() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  scale_x_discrete(guide = guide_axis(n.dodge=2))
```

@fig-model-gun-owner shows the estimated probability that an individual supports Biden given their gun ownership status. We can see that Personal gun ownership and the Not Sure if anyone in the household owns a gun categories show a lower support of Biden, while the No One in the household and the Someone else in the household owns a gun categories show a higher trend of support for Biden. There appears to be an expected cluster of blue dots higher up and red dots lower down, which supports the accuracy of our model.


# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

## Second discussion point

## Third discussion point

## Weaknesses and next steps


\newpage


\appendix

# Appendix {-}

# Additional data details


# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. It shows a very close match between the actual outcome variable with simulations from the posterior distribution. This suggests that our model does a good job of fitting the data.

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. It shows that estimates changed minimally once the data was taken into account. This suggests that we specified good priors. 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

# Read data
ces2020_analysis_data <- read_parquet(here::here("data/analysis_data/ces2020_analysis_data.parquet"))

set.seed(321)

# Randomly sample 5000 observations in the interest of run-time
ces2020_reduced <- 
  ces2020_analysis_data |> 
  slice_sample(n = 5000)

pp_check(political_preferences) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(political_preferences) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-diagnostics-1 is a trace plot. It shows that there are no horizontal lines that appear to bounce around and have a nice overlap between the chains. This does not suggest anything out of the ordinary.

@fig-diagnostics-2 is a Rhat plot. It shows that everything is close to 1 and no more than 1.1. This does not suggest any problems.

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-diagnostics
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(political_preferences, "trace")

plot(political_preferences, "rhat")
```


\newpage


# References
